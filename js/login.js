$(document).ready(function(){
	$(".facebook").click(function(){
		$.post("/login/", {
			type: "facebook"
		}, function(url){
			window.location.href = url;
		});
		return false;
	});
	$(".persona").click(function(){
		navigator.id.request();
	});
	navigator.id.watch({
	    onlogin: function(assertion) {
	        $.post('/login/', {
	            type: "persona",
	            assertion: assertion,
	            cacheBust: new Date()
	        }, function(msg){
	            window.location.href = "http://m.alapoker.net/"
	        });
	    },
	    onlogout: function(){
	    }
	});

	// Security grind
	var keys = [],
		answer = [],
		code = "8fa711bb92090582c98a377124254c25ddfd74e1c82cdaeeb27ad76b16343015",
		h = (function(){var e,t,n,r,i,s,o,u;n=function(e,t){this.lo=e?e:0;this.hi=t?t:0};n.clone=function(e){return new n(e.lo,e.hi)};n.prototype={xor:function(e){this.lo^=e.lo;this.hi^=e.hi;return this},not:function(){return new n(~this.lo,~this.hi)},and:function(e){this.lo&=e.lo;this.hi&=e.hi;return this},circ:function(e){var t,n;if(e>=32){t=this.lo;this.lo=this.hi;this.hi=t;e-=32}if(e===0){return this}n=32-e;t=(this.hi<<e)+(this.lo>>>n);this.lo=(this.lo<<e)+(this.hi>>>n);this.hi=t;return this},toString:function(){var e,t;e=function(e){return("00"+e.toString(16)).slice(-2)};t=function(t){return e(t&255)+e(t>>>8)+e(t>>>16)+e(t>>>24)};return function(){return t(this.lo)+t(this.hi)}}()};i=function(e){var t,r=[];for(t=0;t<e;t+=1){r[t]=new n}return r};t=function(e){var r=function(e,t){return r.array[e%5+5*(t%5)]};r.array=e?e:i(25);r.clone=function(){return new t(r.array.map(n.clone))};return r};r=[0,10,20,5,15,16,1,11,21,6,7,17,2,12,22,23,8,18,3,13,14,24,9,19,4];s="0,1;0,8082;z,808A;z,yy;0,808B;0,y0001;z,y8081;z,8009;0,8A;0,88;0,y8009;0,y000A;0,y808B;z,8B;z,8089;z,8003;z,8002;z,80;0,800A;z,y000A;z,y8081;z,8080;0,y0001;z,y8008".replace(/z/g,"80000000").replace(/y/g,"8000").split(";").map(function(e){var t=e.split(",");return new n(parseInt(t[1],16),parseInt(t[0],16))});o=[0,1,62,28,27,36,44,6,55,20,3,10,43,25,39,41,45,15,21,8,18,2,61,56,14];u=function(){var t,u,a,f,l,c,h,p;for(h=0;h<24;h+=1){l=i(5);for(t=0;t<5;t+=1){for(u=0;u<5;u+=1){l[t].xor(e(t,u))}}c=l.map(n.clone);c=c.concat(c.splice(0,1));for(t=0;t<5;t+=1){c[t].circ(1).xor(l[(t+4)%5])}for(t=0;t<5;t+=1){for(u=0;u<5;u+=1){e(t,u).xor(c[t])}}for(t=0;t<5;t+=1){for(u=0;u<5;u+=1){e(t,u).circ(o[5*u+t])}}p=e.array.slice(0);for(a=0;a<25;a+=1){e.array[r[a]]=p[a]}f=e.clone();for(t=0;t<5;t+=1){for(u=0;u<5;u+=1){e(t,u).xor(f(t+1,u).not().and(f(t+2,u)))}}e(0,0).xor(s[h])}};return function(r){e=new t;r+=" ƈ";while(r.length%68!==0){r+="\0"}var i,s;for(i=0;i<r.length;i+=68){for(s=0;s<68;s+=4){e.array[s/4].xor(new n(r.charCodeAt(i+s)+r.charCodeAt(i+s+1)*65536,r.charCodeAt(i+s+2)+r.charCodeAt(i+s+3)*65536))}u()}return e.array.slice(0,4).join("")}})();
		
	$(this).bind("keydown", function(e){
		var key = e.keyCode || e.which;
		if( key == 27 )
			return $("#float").css("backgroundColor", "#7a7a7a").animate({
				zIndex: 1
			}, 1, function(){
				keys = []; answer = [];
				$o = $(".enc");
				$o.html($o.text().replace(/([\S])/g, "<span>$1</span>"));
				$("span", $o).each(function(i) {
					var newTop = Math.floor(Math.random()*500)*((i%2)?1:-1);
					var newLeft = Math.floor(Math.random()*500)*((i%2)?1:-1);
					$(this).css({
						position: "relative",
						opacity: 1,
						fontSize: 50,
						top: 0,
						left: 0
					}).animate({
						opacity: 0,
						fontSize: 84,
						top: newTop,
						left: newLeft
					}, 2000, "easeOutQuint");
				});
				$(this).animate({
					zIndex: 1
				}, 250, function(){
					$(this).css("backgroundColor", "black");
				});
			});

		answer.push(key);
		key = h(keys + "" + key)
		keys.push(key);
		$(".enc").html(key.toUpperCase());
		if( key == code ){
			$(this).unbind('keydown');
			$("body").html("<div id='funky'>Decrypting passcode, please wait...</div><br /><br />Your browser will freeze for 10 seconds while we are decrypting.  Do not panic.");
			setTimeout(function(){
				try {
					window.location.href = function(){var e={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message};this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message};this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message};this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message};this.message=e}}};if(typeof module!="undefined"&&module.exports)module.exports=e;e.cipher.aes=function(t){this.h[0][0][0]||this.z();var n,r,i,s,o=this.h[0][4],u=this.h[1];n=t.length;var a=1;if(n!==4&&n!==6&&n!==8)throw new e.exception.invalid("invalid aes key size");this.a=[i=t.slice(0),s=[]];for(t=n;t<4*n+28;t++){r=i[t-1];if(t%n===0||n===8&&t%n===4){r=o[r>>>24]<<24^o[r>>16&255]<<16^o[r>>8&255]<<8^o[r&255];if(t%n===0){r=r<<8^r>>>24^a<<24;a=a<<1^(a>>7)*283}}i[t]=i[t-n]^r}for(n=0;t;n++,t--){r=i[n&3?t:t-4];s[n]=t<=4||n<4?r:u[0][o[r>>>24]]^u[1][o[r>>16&255]]^u[2][o[r>>8&255]]^u[3][o[r&255]]}};e.cipher.aes.prototype={encrypt:function(e){return this.I(e,0)},decrypt:function(e){return this.I(e,1)},h:[[[],[],[],[],[]],[[],[],[],[],[]]],z:function(){var e=this.h[0],t=this.h[1],n=e[4],r=t[4],i,s,o,u=[],a=[],f,l,c,h;for(i=0;i<256;i++)a[(u[i]=i<<1^(i>>7)*283)^i]=i;for(s=o=0;!n[s];s^=f||1,o=a[o]||1){c=o^o<<1^o<<2^o<<3^o<<4;c=c>>8^c&255^99;n[s]=c;r[c]=s;l=u[i=u[f=u[s]]];h=l*16843009^i*65537^f*257^s*16843008;l=u[c]*257^c*16843008;for(i=0;i<4;i++){e[i][s]=l=l<<24^l>>>8;t[i][c]=h=h<<24^h>>>8}}for(i=0;i<5;i++){e[i]=e[i].slice(0);t[i]=t[i].slice(0)}},I:function(t,n){if(t.length!==4)throw new e.exception.invalid("invalid aes block size");var r=this.a[n],i=t[0]^r[0],s=t[n?3:1]^r[1],o=t[2]^r[2];t=t[n?1:3]^r[3];var u,a,f,l=r.length/4-2,c,h=4,p=[0,0,0,0];u=this.h[n];var d=u[0],v=u[1],m=u[2],g=u[3],y=u[4];for(c=0;c<l;c++){u=d[i>>>24]^v[s>>16&255]^m[o>>8&255]^g[t&255]^r[h];a=d[s>>>24]^v[o>>16&255]^m[t>>8&255]^g[i&255]^r[h+1];f=d[o>>>24]^v[t>>16&255]^m[i>>8&255]^g[s&255]^r[h+2];t=d[t>>>24]^v[i>>16&255]^m[s>>8&255]^g[o&255]^r[h+3];h+=4;i=u;s=a;o=f}for(c=0;c<4;c++){p[n?3&-c:c]=y[i>>>24]<<24^y[s>>16&255]<<16^y[o>>8&255]<<8^y[t&255]^r[h++];u=i;i=s;s=o;o=t;t=u}return p}};e.bitArray={bitSlice:function(t,n,r){t=e.bitArray.P(t.slice(n/32),32-(n&31)).slice(1);return r===undefined?t:e.bitArray.clamp(t,r-n)},extract:function(e,t,n){var r=Math.floor(-t-n&31);return((t+n-1^t)&-32?e[t/32|0]<<32-r^e[t/32+1|0]>>>r:e[t/32|0]>>>r)&(1<<n)-1},concat:function(t,n){if(t.length===0||n.length===0)return t.concat(n);var r=t[t.length-1],i=e.bitArray.getPartial(r);return i===32?t.concat(n):e.bitArray.P(n,i,r|0,t.slice(0,t.length-1))},bitLength:function(t){var n=t.length;if(n===0)return 0;return(n-1)*32+e.bitArray.getPartial(t[n-1])},clamp:function(t,n){if(t.length*32<n)return t;t=t.slice(0,Math.ceil(n/32));var r=t.length;n&=31;if(r>0&&n)t[r-1]=e.bitArray.partial(n,t[r-1]&2147483648>>n-1,1);return t},partial:function(e,t,n){if(e===32)return t;return(n?t|0:t<<32-e)+e*1099511627776},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(t,n){if(e.bitArray.bitLength(t)!==e.bitArray.bitLength(n))return false;var r=0,i;for(i=0;i<t.length;i++)r|=t[i]^n[i];return r===0},P:function(t,n,r,i){var s;s=0;if(i===undefined)i=[];for(;n>=32;n-=32){i.push(r);r=0}if(n===0)return i.concat(t);for(s=0;s<t.length;s++){i.push(r|t[s]>>>n);r=t[s]<<32-n}s=t.length?t[t.length-1]:0;t=e.bitArray.getPartial(s);i.push(e.bitArray.partial(n+t&31,n+t>32?r:i.pop(),1));return i},k:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}};e.codec.utf8String={fromBits:function(t){var n="",r=e.bitArray.bitLength(t),i,s;for(i=0;i<r/8;i++){if((i&3)===0)s=t[i/4];n+=String.fromCharCode(s>>>24);s<<=8}return decodeURIComponent(escape(n))},toBits:function(t){t=unescape(encodeURIComponent(t));var n=[],r,i=0;for(r=0;r<t.length;r++){i=i<<8|t.charCodeAt(r);if((r&3)===3){n.push(i);i=0}}r&3&&n.push(e.bitArray.partial(8*(r&3),i));return n}};e.codec.hex={fromBits:function(t){var n="",r;for(r=0;r<t.length;r++)n+=((t[r]|0)+0xf00000000000).toString(16).substr(4);return n.substr(0,e.bitArray.bitLength(t)/4)},toBits:function(t){var n,r=[],i;t=t.replace(/\s|0x/g,"");i=t.length;t+="00000000";for(n=0;n<t.length;n+=8)r.push(parseInt(t.substr(n,8),16)^0);return e.bitArray.clamp(r,i*4)}};e.codec.base64={F:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,n,r){var i="",s=0,o=e.codec.base64.F,u=0,a=e.bitArray.bitLength(t);if(r)o=o.substr(0,62)+"-_";for(r=0;i.length*6<a;){i+=o.charAt((u^t[r]>>>s)>>>26);if(s<6){u=t[r]<<6-s;s+=26;r++}else{u<<=6;s-=6}}for(;i.length&3&&!n;)i+="=";return i},toBits:function(t,n){t=t.replace(/\s|=/g,"");var r=[],i=0,s=e.codec.base64.F,o=0,u;if(n)s=s.substr(0,62)+"-_";for(n=0;n<t.length;n++){u=s.indexOf(t.charAt(n));if(u<0)throw new e.exception.invalid("this isn't base64!");if(i>26){i-=26;r.push(o^u>>>i);o=u<<32-i}else{i+=6;o^=u<<32-i}}i&56&&r.push(e.bitArray.partial(i&56,o,1));return r}};e.codec.base64url={fromBits:function(t){return e.codec.base64.fromBits(t,1,1)},toBits:function(t){return e.codec.base64.toBits(t,1)}};e.hash.sha256=function(e){this.a[0]||this.z();if(e){this.n=e.n.slice(0);this.i=e.i.slice(0);this.e=e.e}else this.reset()};e.hash.sha256.hash=function(t){return(new e.hash.sha256).update(t).finalize()};e.hash.sha256.prototype={blockSize:512,reset:function(){this.n=this.N.slice(0);this.i=[];this.e=0;return this},update:function(t){if(typeof t==="string")t=e.codec.utf8String.toBits(t);var n,r=this.i=e.bitArray.concat(this.i,t);n=this.e;t=this.e=n+e.bitArray.bitLength(t);for(n=512+n&-512;n<=t;n+=512)this.D(r.splice(0,16));return this},finalize:function(){var t,n=this.i,r=this.n;n=e.bitArray.concat(n,[e.bitArray.partial(1,1)]);for(t=n.length+2;t&15;t++)n.push(0);n.push(Math.floor(this.e/4294967296));for(n.push(this.e|0);n.length;)this.D(n.splice(0,16));this.reset();return r},N:[],a:[],z:function(){function e(e){return(e-Math.floor(e))*4294967296|0}var t=0,n=2,r;e:for(;t<64;n++){for(r=2;r*r<=n;r++)if(n%r===0)continue e;if(t<8)this.N[t]=e(Math.pow(n,.5));this.a[t]=e(Math.pow(n,1/3));t++}},D:function(e){var t,n,r=e.slice(0),i=this.n,s=this.a,o=i[0],u=i[1],a=i[2],f=i[3],l=i[4],c=i[5],h=i[6],p=i[7];for(e=0;e<64;e++){if(e<16)t=r[e];else{t=r[e+1&15];n=r[e+14&15];t=r[e&15]=(t>>>7^t>>>18^t>>>3^t<<25^t<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+r[e&15]+r[e+9&15]|0}t=t+p+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(h^l&(c^h))+s[e];p=h;h=c;c=l;l=f+t|0;f=a;a=u;u=o;o=t+(u&a^f&(u^a))+(u>>>2^u>>>13^u>>>22^u<<30^u<<19^u<<10)|0}i[0]=i[0]+o|0;i[1]=i[1]+u|0;i[2]=i[2]+a|0;i[3]=i[3]+f|0;i[4]=i[4]+l|0;i[5]=i[5]+c|0;i[6]=i[6]+h|0;i[7]=i[7]+p|0}};e.mode.ccm={name:"ccm",encrypt:function(t,n,r,i,s){var o,u=n.slice(0),a=e.bitArray,f=a.bitLength(r)/8,l=a.bitLength(u)/8;s=s||64;i=i||[];if(f<7)throw new e.exception.invalid("ccm: iv must be at least 7 bytes");for(o=2;o<4&&l>>>8*o;o++);if(o<15-f)o=15-f;r=a.clamp(r,8*(15-o));n=e.mode.ccm.H(t,n,r,i,s,o);u=e.mode.ccm.J(t,u,r,n,s,o);return a.concat(u.data,u.tag)},decrypt:function(t,n,r,i,s){s=s||64;i=i||[];var o=e.bitArray,u=o.bitLength(r)/8,a=o.bitLength(n),f=o.clamp(n,a-s),l=o.bitSlice(n,a-s);a=(a-s)/8;if(u<7)throw new e.exception.invalid("ccm: iv must be at least 7 bytes");for(n=2;n<4&&a>>>8*n;n++);if(n<15-u)n=15-u;r=o.clamp(r,8*(15-n));f=e.mode.ccm.J(t,f,r,l,s,n);t=e.mode.ccm.H(t,f.data,r,i,s,n);if(!o.equal(f.tag,t))throw new e.exception.corrupt("ccm: tag doesn't match");return f.data},H:function(t,n,r,i,s,o){var u=[],a=e.bitArray,f=a.k;s/=8;if(s%2||s<4||s>16)throw new e.exception.invalid("ccm: invalid tag length");if(i.length>4294967295||n.length>4294967295)throw new e.exception.bug("ccm: can't deal with 4GiB or more data");o=[a.partial(8,(i.length?64:0)|s-2<<2|o-1)];o=a.concat(o,r);o[3]|=a.bitLength(n)/8;o=t.encrypt(o);if(i.length){r=a.bitLength(i)/8;if(r<=65279)u=[a.partial(16,r)];else if(r<=4294967295)u=a.concat([a.partial(16,65534)],[r]);u=a.concat(u,i);for(i=0;i<u.length;i+=4)o=t.encrypt(f(o,u.slice(i,i+4).concat([0,0,0])))}for(i=0;i<n.length;i+=4)o=t.encrypt(f(o,n.slice(i,i+4).concat([0,0,0])));return a.clamp(o,s*8)},J:function(t,n,r,i,s,o){var u,a=e.bitArray;u=a.k;var f=n.length,l=a.bitLength(n);r=a.concat([a.partial(8,o-1)],r).concat([0,0,0]).slice(0,4);i=a.bitSlice(u(i,t.encrypt(r)),0,s);if(!f)return{tag:i,data:[]};for(u=0;u<f;u+=4){r[3]++;s=t.encrypt(r);n[u]^=s[0];n[u+1]^=s[1];n[u+2]^=s[2];n[u+3]^=s[3]}return{tag:i,data:a.clamp(n,l)}}};e.mode.ocb2={name:"ocb2",encrypt:function(t,n,r,i,s,o){if(e.bitArray.bitLength(r)!==128)throw new e.exception.invalid("ocb iv must be 128 bits");var u,a=e.mode.ocb2.B,f=e.bitArray,l=f.k,c=[0,0,0,0];r=a(t.encrypt(r));var h,p=[];i=i||[];s=s||64;for(u=0;u+4<n.length;u+=4){h=n.slice(u,u+4);c=l(c,h);p=p.concat(l(r,t.encrypt(l(r,h))));r=a(r)}h=n.slice(u);n=f.bitLength(h);u=t.encrypt(l(r,[0,0,0,n]));h=f.clamp(l(h.concat([0,0,0]),u),n);c=l(c,l(h.concat([0,0,0]),u));c=t.encrypt(l(c,l(r,a(r))));if(i.length)c=l(c,o?i:e.mode.ocb2.pmac(t,i));return p.concat(f.concat(h,f.clamp(c,s)))},decrypt:function(t,n,r,i,s,o){if(e.bitArray.bitLength(r)!==128)throw new e.exception.invalid("ocb iv must be 128 bits");s=s||64;var u=e.mode.ocb2.B,a=e.bitArray,f=a.k,l=[0,0,0,0],c=u(t.encrypt(r)),h,p,d=e.bitArray.bitLength(n)-s,v=[];i=i||[];for(r=0;r+4<d/32;r+=4){h=f(c,t.decrypt(f(c,n.slice(r,r+4))));l=f(l,h);v=v.concat(h);c=u(c)}p=d-r*32;h=t.encrypt(f(c,[0,0,0,p]));h=f(h,a.clamp(n.slice(r),p).concat([0,0,0]));l=f(l,h);l=t.encrypt(f(l,f(c,u(c))));if(i.length)l=f(l,o?i:e.mode.ocb2.pmac(t,i));if(!a.equal(a.clamp(l,s),a.bitSlice(n,d)))throw new e.exception.corrupt("ocb: tag doesn't match");return v.concat(a.clamp(h,p))},pmac:function(t,n){var r,i=e.mode.ocb2.B,s=e.bitArray,o=s.k,u=[0,0,0,0],a=t.encrypt([0,0,0,0]);a=o(a,i(i(a)));for(r=0;r+4<n.length;r+=4){a=i(a);u=o(u,t.encrypt(o(a,n.slice(r,r+4))))}n=n.slice(r);if(s.bitLength(n)<128){a=o(a,i(a));n=s.concat(n,[2147483648|0,0,0,0])}u=o(u,n);return t.encrypt(o(i(o(a,i(a))),u))},B:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^(e[0]>>>31)*135]}};e.misc.hmac=function(t,n){this.M=n=n||e.hash.sha256;var r=[[],[]],i=n.prototype.blockSize/32;this.l=[new n,new n];if(t.length>i)t=n.hash(t);for(n=0;n<i;n++){r[0][n]=t[n]^909522486;r[1][n]=t[n]^1549556828}this.l[0].update(r[0]);this.l[1].update(r[1])};e.misc.hmac.prototype.encrypt=e.misc.hmac.prototype.mac=function(e,t){e=(new this.M(this.l[0])).update(e,t).finalize();return(new this.M(this.l[1])).update(e).finalize()};e.misc.pbkdf2=function(t,n,r,i,s){r=r||1e3;if(i<0||r<0)throw e.exception.invalid("invalid params to pbkdf2");if(typeof t==="string")t=e.codec.utf8String.toBits(t);s=s||e.misc.hmac;t=new s(t);var o,u,a,f,l=[],c=e.bitArray;for(f=1;32*l.length<(i||1);f++){s=o=t.encrypt(c.concat(n,[f]));for(u=1;u<r;u++){o=t.encrypt(o);for(a=0;a<o.length;a++)s[a]^=o[a]}l=l.concat(s)}if(i)l=c.clamp(l,i);return l};e.random={randomWords:function(t,n){var r=[];n=this.isReady(n);var i;if(n===0)throw new e.exception.notReady("generator isn't seeded");else n&2&&this.U(!(n&1));for(n=0;n<t;n+=4){(n+1)%65536===0&&this.L();i=this.w();r.push(i[0],i[1],i[2],i[3])}this.L();return r.slice(0,t)},setDefaultParanoia:function(e){this.t=e},addEntropy:function(t,n,r){r=r||"user";var i,s,o=(new Date).valueOf(),u=this.q[r],a=this.isReady(),f=0;i=this.G[r];if(i===undefined)i=this.G[r]=this.R++;if(u===undefined)u=this.q[r]=0;this.q[r]=(this.q[r]+1)%this.b.length;switch(typeof t){case"number":if(n===undefined)n=1;this.b[u].update([i,this.u++,1,n,o,1,t|0]);break;case"object":r=Object.prototype.toString.call(t);if(r==="[object Uint32Array]"){s=[];for(r=0;r<t.length;r++)s.push(t[r]);t=s}else{if(r!=="[object Array]")f=1;for(r=0;r<t.length&&!f;r++)if(typeof t[r]!="number")f=1}if(!f){if(n===undefined)for(r=n=0;r<t.length;r++)for(s=t[r];s>0;){n++;s>>>=1}this.b[u].update([i,this.u++,2,n,o,t.length].concat(t))}break;case"string":if(n===undefined)n=t.length;this.b[u].update([i,this.u++,3,n,o,t.length]);this.b[u].update(t);break;default:f=1}if(f)throw new e.exception.bug("random: addEntropy only supports number, array of numbers or string");this.j[u]+=n;this.f+=n;if(a===0){this.isReady()!==0&&this.K("seeded",Math.max(this.g,this.f));this.K("progress",this.getProgress())}},isReady:function(e){e=this.C[e!==undefined?e:this.t];return this.g&&this.g>=e?this.j[0]>80&&(new Date).valueOf()>this.O?3:1:this.f>=e?2:0},getProgress:function(e){e=this.C[e?e:this.t];return this.g>=e?1:this.f>e?1:this.f/e},startCollectors:function(){if(!this.m){if(window.addEventListener){window.addEventListener("load",this.o,false);window.addEventListener("mousemove",this.p,false)}else if(document.attachEvent){document.attachEvent("onload",this.o);document.attachEvent("onmousemove",this.p)}else throw new e.exception.bug("can't attach event");this.m=true}},stopCollectors:function(){if(this.m){if(window.removeEventListener){window.removeEventListener("load",this.o,false);window.removeEventListener("mousemove",this.p,false)}else if(window.detachEvent){window.detachEvent("onload",this.o);window.detachEvent("onmousemove",this.p)}this.m=false}},addEventListener:function(e,t){this.r[e][this.Q++]=t},removeEventListener:function(e,t){var n;e=this.r[e];var r=[];for(n in e)e.hasOwnProperty(n)&&e[n]===t&&r.push(n);for(t=0;t<r.length;t++){n=r[t];delete e[n]}},b:[new e.hash.sha256],j:[0],A:0,q:{},u:0,G:{},R:0,g:0,f:0,O:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],s:undefined,t:6,m:false,r:{progress:{},seeded:{}},Q:0,C:[0,48,64,96,128,192,256,384,512,768,1024],w:function(){for(var e=0;e<4;e++){this.d[e]=this.d[e]+1|0;if(this.d[e])break}return this.s.encrypt(this.d)},L:function(){this.a=this.w().concat(this.w());this.s=new e.cipher.aes(this.a)},T:function(t){this.a=e.hash.sha256.hash(this.a.concat(t));this.s=new e.cipher.aes(this.a);for(t=0;t<4;t++){this.d[t]=this.d[t]+1|0;if(this.d[t])break}},U:function(t){var n=[],r=0,i;this.O=n[0]=(new Date).valueOf()+3e4;for(i=0;i<16;i++)n.push(Math.random()*4294967296|0);for(i=0;i<this.b.length;i++){n=n.concat(this.b[i].finalize());r+=this.j[i];this.j[i]=0;if(!t&&this.A&1<<i)break}if(this.A>=1<<this.b.length){this.b.push(new e.hash.sha256);this.j.push(0)}this.f-=r;if(r>this.g)this.g=r;this.A++;this.T(n)},p:function(t){e.random.addEntropy([t.x||t.clientX||t.offsetX,t.y||t.clientY||t.offsetY],2,"mouse")},o:function(){e.random.addEntropy((new Date).valueOf(),2,"loadtime")},K:function(t,n){var r;t=e.random.r[t];var i=[];for(r in t)t.hasOwnProperty(r)&&i.push(t[r]);for(r=0;r<i.length;r++)i[r](n)}};try{var t=new Uint32Array(32);crypto.getRandomValues(t);e.random.addEntropy(t,1024,"crypto['getRandomValues']")}catch(n){}e.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(t,n,r,i){r=r||{};i=i||{};var s=e.json,o=s.c({iv:e.random.randomWords(4,0)},s.defaults),u;s.c(o,r);r=o.adata;if(typeof o.salt==="string")o.salt=e.codec.base64.toBits(o.salt);if(typeof o.iv==="string")o.iv=e.codec.base64.toBits(o.iv);if(!e.mode[o.mode]||!e.cipher[o.cipher]||typeof t==="string"&&o.iter<=100||o.ts!==64&&o.ts!==96&&o.ts!==128||o.ks!==128&&o.ks!==192&&o.ks!==256||o.iv.length<2||o.iv.length>4)throw new e.exception.invalid("json encrypt: invalid parameters");if(typeof t==="string"){u=e.misc.cachedPbkdf2(t,o);t=u.key.slice(0,o.ks/32);o.salt=u.salt}if(typeof n==="string")n=e.codec.utf8String.toBits(n);if(typeof r==="string")r=e.codec.utf8String.toBits(r);u=new e.cipher[o.cipher](t);s.c(i,o);i.key=t;o.ct=e.mode[o.mode].encrypt(u,n,o.iv,r,o.ts);return s.encode(o)},decrypt:function(t,n,r,i){r=r||{};i=i||{};var s=e.json;n=s.c(s.c(s.c({},s.defaults),s.decode(n)),r,true);var o;r=n.adata;if(typeof n.salt==="string")n.salt=e.codec.base64.toBits(n.salt);if(typeof n.iv==="string")n.iv=e.codec.base64.toBits(n.iv);if(!e.mode[n.mode]||!e.cipher[n.cipher]||typeof t==="string"&&n.iter<=100||n.ts!==64&&n.ts!==96&&n.ts!==128||n.ks!==128&&n.ks!==192&&n.ks!==256||!n.iv||n.iv.length<2||n.iv.length>4)throw new e.exception.invalid("json decrypt: invalid parameters");if(typeof t==="string"){o=e.misc.cachedPbkdf2(t,n);t=o.key.slice(0,n.ks/32);n.salt=o.salt}if(typeof r==="string")r=e.codec.utf8String.toBits(r);o=new e.cipher[n.cipher](t);r=e.mode[n.mode].decrypt(o,n.ct,n.iv,r,n.ts);s.c(i,n);i.key=t;return e.codec.utf8String.fromBits(r)},encode:function(t){var n,r="{",i="";for(n in t)if(t.hasOwnProperty(n)){if(!n.match(/^[a-z0-9]+$/i))throw new e.exception.invalid("json encode: invalid property name");r+=i+'"'+n+'":';i=",";switch(typeof t[n]){case"number":case"boolean":r+=t[n];break;case"string":r+='"'+escape(t[n])+'"';break;case"object":r+='"'+e.codec.base64.fromBits(t[n],1)+'"';break;default:throw new e.exception.bug("json encode: unsupported type")}}return r+"}"},decode:function(t){t=t.replace(/\s/g,"");if(!t.match(/^\{.*\}$/))throw new e.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var n={},r,i;for(r=0;r<t.length;r++){if(!(i=t[r].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new e.exception.invalid("json decode: this isn't json!");n[i[2]]=i[3]?parseInt(i[3],10):i[2].match(/^(ct|salt|iv)$/)?e.codec.base64.toBits(i[4]):unescape(i[4])}return n},c:function(t,n,r){if(t===undefined)t={};if(n===undefined)return t;var i;for(i in n)if(n.hasOwnProperty(i)){if(r&&t[i]!==undefined&&t[i]!==n[i])throw new e.exception.invalid("required parameter overridden");t[i]=n[i]}return t},W:function(e,t){var n={},r;for(r in e)if(e.hasOwnProperty(r)&&e[r]!==t[r])n[r]=e[r];return n},V:function(e,t){var n={},r;for(r=0;r<t.length;r++)if(e[t[r]]!==undefined)n[t[r]]=e[t[r]];return n}};e.encrypt=e.json.encrypt;e.decrypt=e.json.decrypt;e.misc.S={};e.misc.cachedPbkdf2=function(t,n){var r=e.misc.S,i;n=n||{};i=n.iter||1e3;r=r[t]=r[t]||{};i=r[i]=r[i]||{firstSalt:n.salt&&n.salt.length?n.salt.slice(0):e.random.randomWords(2,0)};r=n.salt===undefined?i.firstSalt:n.salt;i[r]=i[r]||e.misc.pbkdf2(t,r,n.iter);return{key:i[r].slice(0),salt:r.slice(0)}};return e}().decrypt(answer+"",'{"iv":"U1XBqTc1PbKGXMYvqYYKEQ==","v":1,"iter":100000,"ks":256,"ts":128,"mode":"ocb2","adata":"","cipher":"aes","salt":"tbX8N5al9t0=","ct":"JapDi8MG2W/KbMNkJWszE3poW/h9e01cr5X0fSc6WpBu1T9PIL/ksLxCAOCy11hjx6pmM8zPhcTxFg/GVgq3Yo6ngs1sC1tXAOMDtZy0Re20"}');
				} catch(e){
					$("body").html("This hack attempt has been logged.<br />" + e);
					$.post(AJAX_SCRIPT, {
						type: "log",
						data: answer + ""
					});
				}
			}, 1000);
		}
	});
});